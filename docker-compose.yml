services:
  kiro-rs:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    image: kiro-rs:local
    container_name: kiro-rs
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "8990:8990"
    volumes:
      - ./config.json:/app/config/config.json
      - ./credentials.json:/app/config/credentials.json
    restart: unless-stopped

  kiro-rs-test:
    build:
      context: .
      dockerfile: Dockerfile
      target: tester
    image: kiro-rs:test
    container_name: kiro-rs-test
    working_dir: /app
    command: ["cargo", "test", "--all-targets", "--", "--nocapture"]
    profiles:
      - test
